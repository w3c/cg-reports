<!DOCTYPE html><html dir="ltr" lang="en"><head>
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 32.2.5">
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-width:.2em;border-style:solid;background:#fbe9e9}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>



<title>RDF Dataset Canonicalization</title>

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>



<style type="text/css">

  .highlight { font-weight: bold; color: #0a3; }
  .comment { color: #999; }
  table, thead, tr, td { padding: 5px; border-width: 1px; border-spacing: 0px; border-style: solid; border-collapse: collapse; }
  ol.algorithm {
    counter-reset: numsection;
    list-style-type: none;
  }
  ol.algorithm li {
    margin: 0.5em 0;
  }
  ol.algorithm li:before {
    font-weight: bold;
    counter-increment: numsection;
    content: counters(numsection, ".") ") ";
  }
  a.externalDFN {border-bottom:  1px solid #99c; font-style: italic;}

</style>

<meta name="description" content="RDF [RDF-CONCEPTS] describes a graph-based data model for making claims
    about the world and provides the foundation for reasoning upon that graph
    of information. At times, it becomes necessary to compare the differences
    between sets of graphs, digitally sign them, or generate short identifiers
    for graphs via hashing algorithms. This document outlines an algorithm for
    normalizing RDF datasets such that these operations can be
    performed.">
<link rel="canonical" href="https://www.w3.org/community/reports/credentials/rdf-dataset-canonicalization/">
<script type="application/ld+json">{
  "@context": [
    "http://schema.org",
    {
      "@vocab": "http://schema.org/",
      "@language": "en",
      "w3p": "http://www.w3.org/2001/02pd/rec54#",
      "foaf": "http://xmlns.com/foaf/0.1/",
      "datePublished": {
        "@type": "http://www.w3.org/2001/XMLSchema#date"
      },
      "inLanguage": {
        "@language": null
      },
      "isBasedOn": {
        "@type": "@id"
      },
      "license": {
        "@type": "@id"
      }
    }
  ],
  "id": "https://www.w3.org/community/reports/credentials/rdf-dataset-canonicalization/",
  "type": [
    "TechArticle"
  ],
  "name": "RDF Dataset Canonicalization",
  "inLanguage": "en",
  "license": "https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document",
  "datePublished": "2022-10-09",
  "copyrightHolder": {
    "name": "World Wide Web Consortium",
    "url": "https://www.w3.org/"
  },
  "discussionUrl": "https://github.com/json-ld/rdf-dataset-canonicalization/issues/",
  "alternativeHeadline": "A Standard RDF Dataset Canonicalization Algorithm",
  "isBasedOn": "",
  "description": "RDF [RDF-CONCEPTS] describes a graph-based data model for making claims\n    about the world and provides the foundation for reasoning upon that graph\n    of information. At times, it becomes necessary to compare the differences\n    between sets of graphs, digitally sign them, or generate short identifiers\n    for graphs via hashing algorithms. This document outlines an algorithm for\n    normalizing RDF datasets such that these operations can be\n    performed.",
  "editor": [
    {
      "type": "Person",
      "name": "Dave Longley",
      "url": "https://digitalbazaar.com/",
      "worksFor": {
        "name": "Digital Bazaar",
        "url": "https://digitalbazaar.com/"
      }
    },
    {
      "type": "Person",
      "name": "Manu Sporny",
      "url": "http://manu.sporny.org/",
      "worksFor": {
        "name": "Digital Bazaar",
        "url": "https://digitalbazaar.com/"
      }
    }
  ],
  "contributor": [
    {
      "type": "Person",
      "name": "Dave Longley",
      "url": "https://digitalbazaar.com/",
      "worksFor": {
        "name": "Digital Bazaar",
        "url": "https://digitalbazaar.com/"
      }
    }
  ],
  "citation": [
    {
      "id": "https://www.w3.org/TR/rdf-mt/",
      "type": "TechArticle",
      "name": "RDF Semantics",
      "url": "https://www.w3.org/TR/rdf-mt/",
      "creator": [
        {
          "name": "Patrick Hayes"
        }
      ],
      "publisher": {
        "name": "W3C"
      }
    },
    {
      "id": "https://www.w3.org/TR/rdf-concepts/",
      "type": "TechArticle",
      "name": "Resource Description Framework (RDF): Concepts and Abstract Syntax",
      "url": "https://www.w3.org/TR/rdf-concepts/",
      "creator": [
        {
          "name": "Graham Klyne"
        },
        {
          "name": "Jeremy Carroll"
        }
      ],
      "publisher": {
        "name": "W3C"
      }
    },
    {
      "id": "https://www.rfc-editor.org/rfc/rfc3987",
      "type": "TechArticle",
      "name": "Internationalized Resource Identifiers (IRIs)",
      "url": "https://www.rfc-editor.org/rfc/rfc3987",
      "creator": [
        {
          "name": "M. Duerst"
        },
        {
          "name": "M. Suignard"
        }
      ],
      "publisher": {
        "name": "IETF"
      }
    },
    {
      "id": "https://www.w3.org/TR/rdf11-concepts/",
      "type": "TechArticle",
      "name": "RDF 1.1 Concepts and Abstract Syntax",
      "url": "https://www.w3.org/TR/rdf11-concepts/",
      "creator": [
        {
          "name": "Richard Cyganiak"
        },
        {
          "name": "David Wood"
        },
        {
          "name": "Markus Lanthaler"
        }
      ],
      "publisher": {
        "name": "W3C"
      }
    },
    {
      "id": "https://www.rfc-editor.org/rfc/rfc2119",
      "type": "TechArticle",
      "name": "Key words for use in RFCs to Indicate Requirement Levels",
      "url": "https://www.rfc-editor.org/rfc/rfc2119",
      "creator": [
        {
          "name": "S. Bradner"
        }
      ],
      "publisher": {
        "name": "IETF"
      }
    },
    {
      "id": "https://www.rfc-editor.org/rfc/rfc8174",
      "type": "TechArticle",
      "name": "Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words",
      "url": "https://www.rfc-editor.org/rfc/rfc8174",
      "creator": [
        {
          "name": "B. Leiba"
        }
      ],
      "publisher": {
        "name": "IETF"
      }
    },
    {
      "id": "https://www.w3.org/TR/rdf11-mt/",
      "type": "TechArticle",
      "name": "RDF 1.1 Semantics",
      "url": "https://www.w3.org/TR/rdf11-mt/",
      "creator": [
        {
          "name": "Patrick Hayes"
        },
        {
          "name": "Peter Patel-Schneider"
        }
      ],
      "publisher": {
        "name": "W3C"
      }
    }
  ]
}</script>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "doJsonLd": true,
  "specStatus": "CG-FINAL",
  "copyrightStart": "2010",
  "shortName": "rdf-dataset-canonicalization",
  "subtitle": "A Standard RDF Dataset Canonicalization Algorithm",
  "edDraftURI": "https://json-ld.github.io/rdf-dataset-canonicalization/spec/",
  "github": {
    "repoURL": "https://github.com/json-ld/rdf-dataset-canonicalization/",
    "branch": "main"
  },
  "editors": [
    {
      "name": "Dave Longley",
      "url": "https://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "https://digitalbazaar.com/"
    },
    {
      "name": "Manu Sporny",
      "url": "http://manu.sporny.org/",
      "company": "Digital Bazaar",
      "companyURL": "https://digitalbazaar.com/"
    }
  ],
  "authors": [
    {
      "name": "Dave Longley",
      "url": "https://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "https://digitalbazaar.com/"
    }
  ],
  "group": "credentials",
  "wgURI": "https://www.w3.org/community/credentials/",
  "wgPublicList": "public-credentials-wg@w3.org",
  "wgPatentURI": "https://www.w3.org/Consortium/Patent-Policy-20200915/",
  "maxTocLevel": 2,
  "publishISODate": "2022-10-09T00:00:00.000Z",
  "generatedSubtitle": "Final Community Group Report 09 October 2022"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/cg-final"></head>

<body class="h-entry"><div class="head">
    
    <h1 id="title" class="title">RDF Dataset Canonicalization</h1> <h2 id="subtitle" class="subtitle">A Standard RDF Dataset Canonicalization Algorithm</h2>
    <p id="w3c-state">
      <a href="https://www.w3.org/standards/types#reports">Final Community Group Report</a>
      <time class="dt-published" datetime="2022-10-09">09 October 2022</time>
    </p>
    <dl>
      <dt>This version:</dt><dd>
              <a class="u-url" href="https://www.w3.org/community/reports/credentials/CG-FINAL-rdf-dataset-canonicalization-20221009/">https://www.w3.org/community/reports/credentials/CG-FINAL-rdf-dataset-canonicalization-20221009/</a>
            </dd>
      <dt>Latest published version:</dt><dd>
              <a href="https://www.w3.org/community/reports/credentials/rdf-dataset-canonicalization/">https://www.w3.org/community/reports/credentials/rdf-dataset-canonicalization/</a>
            </dd>
      <dt>Latest editor's draft:</dt><dd><a href="https://json-ld.github.io/rdf-dataset-canonicalization/spec/">https://json-ld.github.io/rdf-dataset-canonicalization/spec/</a></dd>
      
      
      
      
      <dt>Editors:</dt><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://digitalbazaar.com/">Dave Longley</a> (<a class="p-org org h-org" href="https://digitalbazaar.com/">Digital Bazaar</a>)
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="http://manu.sporny.org/">Manu Sporny</a> (<a class="p-org org h-org" href="https://digitalbazaar.com/">Digital Bazaar</a>)
  </dd>
      
      <dt>Author:</dt><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://digitalbazaar.com/">Dave Longley</a> (<a class="p-org org h-org" href="https://digitalbazaar.com/">Digital Bazaar</a>)
  </dd>
      <dt>Feedback:</dt><dd>
        <a href="https://github.com/json-ld/rdf-dataset-canonicalization/">GitHub json-ld/rdf-dataset-canonicalization</a>
        (<a href="https://github.com/json-ld/rdf-dataset-canonicalization/pulls/">pull requests</a>,
        <a href="https://github.com/json-ld/rdf-dataset-canonicalization/issues/new/choose">new issue</a>,
        <a href="https://github.com/json-ld/rdf-dataset-canonicalization/issues/">open issues</a>)
      </dd><dd><a href="mailto:public-credentials-wg@w3.org@w3.org?subject=%5Brdf-dataset-canonicalization%5D%20YOUR%20TOPIC%20HERE">public-credentials-wg@w3.org@w3.org</a> with subject line <kbd>[rdf-dataset-canonicalization] <em>… message topic …</em></kbd> (<a rel="discussion" href="https://lists.w3.org/Archives/Public/public-credentials-wg@w3.org">archives</a>)</dd>
    </dl>
    
    <p class="copyright">
          <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
          ©
          2010-2022
          
          the Contributors to the RDF Dataset Canonicalization
          Specification, published by the
          <a href="https://www.w3.org/groups/cg/credentials">Credentials Community Group</a> under the
          <a href="https://www.w3.org/community/about/agreements/fsa/">W3C Community Final Specification Agreement (FSA)</a>. A human-readable
                <a href="https://www.w3.org/community/about/agreements/fsa-deed/">summary</a>
                is available.
              
        </p>
    <hr title="Separator for header">
  </div>
<section id="abstract" class="introductory"><h2>Abstract</h2>
  <p>RDF [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-concepts" title="Resource Description Framework (RDF): Concepts and Abstract Syntax">RDF-CONCEPTS</a></cite>] describes a graph-based data model for making claims
    about the world and provides the foundation for reasoning upon that graph
    of information. At times, it becomes necessary to compare the differences
    between sets of graphs, digitally sign them, or generate short identifiers
    for graphs via hashing algorithms. This document outlines an algorithm for
    normalizing <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-1">RDF datasets</a> such that these operations can be
    performed.</p>
</section>

<section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/groups/cg/credentials">Credentials Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/final/">W3C Community Final Specification Agreement (FSA)</a>
            other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p>
  <p>This document is a work in progress.</p>
  
<p>
    <a href="https://github.com/json-ld/rdf-dataset-canonicalization/issues/">GitHub Issues</a> are preferred for
          discussion of this specification.
        
    Alternatively, you can send comments to our mailing list.
          Please send them to
          <a href="mailto:public-credentials-wg@w3.org@w3.org">public-credentials-wg@w3.org@w3.org</a>
          (<a href="mailto:public-credentials-wg@w3.org-request@w3.org?subject=subscribe">subscribe</a>,
          <a href="https://lists.w3.org/Archives/Public/public-credentials-wg@w3.org/">archives</a>).
        
  </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#uses-of-dataset-canonicalization"><bdi class="secno">1.1 </bdi>Uses of Dataset Canonicalization</a></li><li class="tocline"><a class="tocxref" href="#how-to-read-this-document"><bdi class="secno">1.2 </bdi>How to Read this Document</a></li><li class="tocline"><a class="tocxref" href="#contributing"><bdi class="secno">1.3 </bdi>Contributing</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#terminology"><bdi class="secno">3. </bdi>Terminology</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#general-terminology"><bdi class="secno">3.1 </bdi>General Terminology</a></li></ol></li><li class="tocline"><a class="tocxref" href="#canonicalization"><bdi class="secno">4. </bdi>Canonicalization</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#canonicalization-algorithm-terms"><bdi class="secno">4.1 </bdi>Canonicalization Algorithm Terms</a></li><li class="tocline"><a class="tocxref" href="#canonicalization-state"><bdi class="secno">4.2 </bdi>Canonicalization State</a></li><li class="tocline"><a class="tocxref" href="#blank-node-identifier-issuer-state"><bdi class="secno">4.3 </bdi>Blank Node Identifier Issuer State</a></li><li class="tocline"><a class="tocxref" href="#canonicalization-algorithm"><bdi class="secno">4.4 </bdi>Canonicalization Algorithm</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#issue-identifier"><bdi class="secno">4.5 </bdi>Issue Identifier Algorithm</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#hash-first-degree-quads"><bdi class="secno">4.6 </bdi>Hash First Degree Quads</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#hash-related-blank-node"><bdi class="secno">4.7 </bdi>Hash Related Blank Node</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#hash-n-degree-quads"><bdi class="secno">4.8 </bdi>Hash N-Degree Quads</a><ol class="toc"></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#use-cases"><bdi class="secno">5. </bdi>Use Cases</a></li><li class="tocline"><a class="tocxref" href="#examples"><bdi class="secno">6. </bdi>Examples</a></li><li class="tocline"><a class="tocxref" href="#urgna2012"><bdi class="secno">A. </bdi><abbr title="Universal RDF Graph Canonicalization Algorithm 2012">URGNA2012</abbr></a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">B. </bdi>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">C. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">C.1 </bdi>Normative references</a></li></ol></li></ol></nav>

<section id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div>
  

  <p>When data scientists discuss canonicalization, they do so in the context of
    achieving a particular set of goals. Since the same information may
    sometimes be expressed in a variety of different ways, it often becomes
    necessary to be able to transform each of these different ways into a
    single, standard format. With a standard format, the differences between
    two different sets of data can be easily determined, a
    cryptographically-strong hash identifier can be generated for a particular
    set of data, and a particular set of data may be digitally-signed for later
    verification.</p>

  <p>In particular, this specification is about normalizing
    <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-2">RDF datasets</a>, which are collections of graphs. Since
    a directed graph can express the same information in more than one
    way, it requires canonicalization to achieve the aforementioned goals
    and any others that may arise via serendipity.</p>

  <p>Most <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-3">RDF datasets</a> can be normalized fairly quickly, in terms
    of algorithmic time complexity. However, those that contain nodes that do
    not have globally unique identifiers pose a greater challenge. Normalizing
    these datasets presents the <dfn id="dfn-graph-isomorphism" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">graph isomorphism</dfn> problem, a
    problem that is believed to be difficult to solve quickly. More formally,
    it is believed to be an NP-Intermediate problem, that is, neither known to
    be solvable in polynomial time nor NP-complete. Fortunately, existing real
    world data is rarely modeled in a way that manifests this problem and new
    data can be modeled to avoid it. In fact, software systems can detect a
    problematic dataset and may choose to assume it's an attempted denial of
    service attack, rather than a real input, and abort.</p>

  <p>This document outlines an algorithm for generating a normalized
    <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-4">RDF dataset</a> given an <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-5">RDF dataset</a> as input. The
    algorithm is called the
    <strong>Universal RDF Dataset Canonicalization Algorithm 2015</strong> or
    <a href="#dfn-urdna2015" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-urdna2015-1"><abbr title="Universal RDF Dataset Canonicalization Algorithm 2015">URDNA2015</abbr></a>.</p>

  <div class="issue" id="issue-container-number-2"><div role="heading" class="issue-title marker" id="h-issue" aria-level="3"><a href="https://github.com/json-ld/rdf-dataset-canonicalization/issues/2"><span class="issue-number">Issue 2</span></a></div><div class=""></div></div>
  <section id="uses-of-dataset-canonicalization"><div class="header-wrapper"><h3 id="x1-1-uses-of-dataset-canonicalization"><bdi class="secno">1.1 </bdi>Uses of Dataset Canonicalization</h3><a class="self-link" href="#uses-of-dataset-canonicalization" aria-label="Permalink for Section 1.1"></a></div>
    
    <p>There are different use cases where graph or dataset canonicalization are important:</p>
    <ul>
      <li>Determining if one serialization is isomorphic to another.</li>
      <li>Digital signing of graphs (datasets) independent of serialization or format.</li>
      <li>Comparing two graphs (datasets) to find differences.</li>
      <li>Communicating change sets when remotely updating an <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-source">RDF source</a>.</li>
    </ul>
    <p>A canonicalization algorithm is necessary, but not necessarily sufficient, to handle many of these use cases. The use of <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-1">blank nodes</a> in RDF graphs and datasets has a long history and creates inevitable complexities. Blank nodes are used for different purposes:</p>
    <ul>
      <li>when a well known identifier for a node is not known, or the author of a document chooses not to unambiguously name that node,</li>
      <li>when a node is used to stitch together parts of a graph and the nodes themselves are not interesting (e.g., <a href="https://www.w3.org/TR/rdf11-mt/#rdf-collections">RDF Collections</a> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-mt" title="RDF Semantics">RDF-MT</a></cite>]),</li>
      <li>when someone is trying to create an intentionally difficult graph topology.</li>
    </ul>
    <p>Further more, RDF semantics dictate that deserializing the same RDF document results in the creation of unique <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-2">blank nodes</a>, unless it can be determined that on each occasion, the <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-1">blank node identifiers</a> the same resource; this is due to the fact that <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-2">blank node identifiers</a> are an aspect of a concrete RDF syntax and are not intended to be persistent or portable. Within the abstract RDF model, blank nodes do not have identifiers (although some <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-store">RDF store</a> implementations may use stable identifiers and choose to make them portable). See <cite><a href="https://www.w3.org/TR/rdf11-concepts/#section-blank-nodes">Blank Nodes</a></cite> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-concepts" title="Resource Description Framework (RDF): Concepts and Abstract Syntax">RDF-CONCEPTS</a></cite>] for more information.</p>
    <p>RDF does have a provision for allowing blank nodes to be published in an externally identifiable way through the use of <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-skolem-iri">Skolem IRIs</a>, which allows a given RDF store to replace the use of blank nodes in a concrete syntax with IRIs, which serve to repeatably identify that blank node within that particular RDF store, however, this is not generally useful for talking about the same graph in different RDF stores, or other concrete representations. In any case, a stable <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-3">blank node identifier</a> defined for one RDF store, serialization is arbitrary, and typically not relatable to the context within which it is used.</p>
    <p>This specification defines an algorithm for creating stable <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-4">blank node identifiers</a> repeatably for different serializations possibly using individualized <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-5">blank node identifiers</a> of the same RDF graph (dataset) by grounding each <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-3">blank node</a> through the nodes to which it is connected, essentially creating <em>Skolem <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-6">blank node identifiers</a></em>. As a result, a graph signature can be obtained by hashing a canonical serialization of the resulting <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-1">normalized dataset</a>, allowing for the isomorphism and digital signing use cases. As blank node identifiers can be stable even with other changes to a graph (dataset), in some cases it is possible to compute the difference between two graphs (datasets), for example if changes are made only to ground triples, or if new blank nodes are introduced which do not create an automorphic confusion with other existing blank nodes. If any information which would change the generated blank node identifier, a resulting diff might indicate a greater set of changes than actually exists.</p>
    <div class="note" id="issue-container-generatedID"><div role="heading" class="ednote-title marker" id="h-ednote" aria-level="4"><span>Editor's note</span></div><p class="">TimBL has a <a href="http://www.w3.org/DesignIssues/Diff">design note</a> on problems with Diff which should be referenced.</p></div>
    <div class="note" id="issue-container-generatedID-0"><div role="heading" class="ednote-title marker" id="h-ednote-0" aria-level="4"><span>Editor's note</span></div><p class="">Jerremy Carroll has a <a href="http://www.hpl.hp.com/techreports/2003/HPL-2003-142.pdf">paper</a> on signing RDF graphs.</p></div>
  </section>

  <section id="how-to-read-this-document"><div class="header-wrapper"><h3 id="x1-2-how-to-read-this-document"><bdi class="secno">1.2 </bdi>How to Read this Document</h3><a class="self-link" href="#how-to-read-this-document" aria-label="Permalink for Section 1.2"></a></div>
    

    <p>This document is a detailed specification for an <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-6">RDF dataset</a>
      canonicalization algorithm. The document is primarily intended for the
      following audiences:</p>

    <ul>
      <li>Software developers that want to implement an <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-7">RDF dataset</a>
        canonicalization algorithm.</li>
      <li>Masochists.</li>
    </ul>

    <p>To understand the basics in this specification you must be familiar with
      basic RDF concepts [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-concepts" title="Resource Description Framework (RDF): Concepts and Abstract Syntax">RDF-CONCEPTS</a></cite>]. A working knowledge of
      <a href="https://en.wikipedia.org/wiki/Graph_theory">graph theory</a> and
      <a href="https://en.wikipedia.org/wiki/Graph_isomorphism">graph isomorphism</a>
      is also recommended.</p>
  </section>

  <section id="contributing"><div class="header-wrapper"><h3 id="x1-3-contributing"><bdi class="secno">1.3 </bdi>Contributing</h3><a class="self-link" href="#contributing" aria-label="Permalink for Section 1.3"></a></div>
    

    <p>There are a number of ways that one may participate in the development
      of this specification:</p>

    <ul>
      <li>Technical discussion typically occurs on the public mailing list:
        <a href="http://lists.w3.org/Archives/Public/public-credentials/">public-credentials@w3.org</a></li>

      <li><a href="https://opencreds.org/minutes/">Public teleconferences</a> are
        held on Tuesdays at 1600UTC every week of each month.</li>

      <li>Specification bugs and issues should be reported in the
        <a href="https://github.com/json-ld/rdf-dataset-canonicalization/issues">issue tracker</a>.</li>

      <li><a href="https://github.com/json-ld/rdf-dataset-canonicalization/tree/main/spec">Source code</a> for the
        specification can be found on GitHub.</li>

      <li>The <a href="https://webchat.freenode.net/?channels=#credentials">#credentials</a>
        IRC channel is available for real-time discussion on
        <a href="irc.freenode.net">irc.freenode.net.</a></li>
    </ul>
  </section>
</section>

<section id="conformance"><div class="header-wrapper"><h2 id="x2-conformance"><bdi class="secno">2. </bdi>Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for Section 2."></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key word <em class="rfc2119">MUST</em> in this document
        is to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p></section>

<section class="normative" id="terminology"><div class="header-wrapper"><h2 id="x3-terminology"><bdi class="secno">3. </bdi>Terminology</h2><a class="self-link" href="#terminology" aria-label="Permalink for Section 3."></a></div>
  

  <section class="normative" id="general-terminology"><div class="header-wrapper"><h3 id="x3-1-general-terminology"><bdi class="secno">3.1 </bdi>General Terminology</h3><a class="self-link" href="#general-terminology" aria-label="Permalink for Section 3.1"></a></div>
    

    <dl>
      <dt><dfn id="dfn-string" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">string</dfn></dt><dd>
        A string is a sequence of zero or more Unicode characters.</dd>
      <dt><code>true</code> and <code>false</code></dt><dd>
        Values that are used to express one of two possible boolean states.</dd>
      <dt><dfn data-lt="internationalized resource identifier|iri|iris|IRI" id="dfn-internationalized-resource-identifier" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><abbr title="Internationalized Resource Identifier">IRI</abbr></dfn></dt>
      <dd>An <a href="#dfn-internationalized-resource-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-internationalized-resource-identifier-1"><abbr title="Internationalized Resource Identifier">IRI</abbr></a> (Internationalized Resource Identifier) is a string that conforms to the syntax
        defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3987" title="Internationalized Resource Identifiers (IRIs)">RFC3987</a></cite>].</dd>
      <dt><dfn data-lt="subject|subjects" id="dfn-subject" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">subject</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-subject">subject</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].</dd>
      <dt><dfn data-lt="predicate|predicates" id="dfn-predicate" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">predicate</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-predicate">predicate</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].</dd>
      <dt><dfn data-lt="object|objects" id="dfn-object" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">object</dfn></dt>
      <dd>An <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-object">object</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].</dd>
      <dt><dfn data-lt="rdf triple|rdf triples|triple|triples|RDF triple" id="dfn-rdf-triple" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">RDF triple</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-triple">triple</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].</dd>
      <dt><dfn data-lt="rdf graph|rdf graphs|graph|graphs|RDF graph" id="dfn-rdf-graph" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">RDF graph</dfn></dt>
      <dd>An <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-graph">RDF graph</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].</dd>
      <dt><dfn data-lt="graph name|graph names" id="dfn-graph-name" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">graph name</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-graph-name">graph name</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].</dd>
      <dt><dfn data-lt="quad|quads" id="dfn-quad" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">quad</dfn></dt>
      <dd>A tuple composed of <a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-1">subject</a>, <a href="#dfn-predicate" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-predicate-1">predicate</a>, <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-1">object</a>, and <a href="#dfn-graph-name" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-name-1">graph name</a>.
        This is a generalization of an <a href="#dfn-rdf-triple" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-triple-1">RDF triple</a> along with a <a href="#dfn-graph-name" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-name-2">graph name</a>.</dd>
      <dt><dfn data-lt="rdf dataset|rdf datasets|dataset|datasets|RDF dataset" id="dfn-rdf-dataset" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">RDF dataset</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-rdf-dataset">dataset</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>].
        For the purposes of this specification, an <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-8">RDF dataset</a>
        is considered to be a set of <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-1">quads</a></dd>
      <dt><dfn data-lt="blank node|blank nodes" id="dfn-blank-node" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">blank node</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node">blank node</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>]. In short, it is a node in a graph that is
        neither an <a href="#dfn-internationalized-resource-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-internationalized-resource-identifier-2"><abbr title="Internationalized Resource Identifier">IRI</abbr></a>, nor a
        <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-literal">literal</a>.</dd>
      <dt><dfn data-lt="blank node identifier|blank node identifiers" id="dfn-blank-node-identifier" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">blank node identifier</dfn></dt>
      <dd>A <a href="https://www.w3.org/TR/rdf11-concepts/#dfn-blank-node-identifier">blank node identifier</a>
        as specified by [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf11-concepts" title="RDF 1.1 Concepts and Abstract Syntax">RDF11-CONCEPTS</a></cite>]. In short, it is a <a href="#dfn-string" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-1">string</a> that begins
        with <code>_:</code> that is used as an identifier for an
        <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-4">blank node</a>. <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-7">Blank node identifiers</a>
        are typically implementation-specific local identifiers; this document
        specifies an algorithm for deterministically specifying them.</dd>
    </dl>
  </section>
</section>

<section id="canonicalization"><div class="header-wrapper"><h2 id="x4-canonicalization"><bdi class="secno">4. </bdi>Canonicalization</h2><a class="self-link" href="#canonicalization" aria-label="Permalink for Section 4."></a></div>
  

  <p>Canonicalization is the process of transforming an
    <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-1">input dataset</a> to a <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-2">normalized dataset</a>. That
    is, any two <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-2">input datasets</a> that contain the same
    information, regardless of their arrangement, will be transformed into
    identical <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-3">normalized dataset</a>. The problem requires directed
    graphs to be deterministically ordered into sets of nodes and edges. This
    is easy to do when all of the nodes have globally-unique identifiers, but
    can be difficult to do when some of the nodes do not. Any nodes without
    globally-unique identifiers must be issued deterministic identifiers.</p>

  <div class="note" id="issue-container-generatedID-1"><div role="heading" class="ednote-title marker" id="h-ednote-1" aria-level="3"><span>Editor's note</span></div><p class="">Strictly speaking, the normalized dataset must be serialized to be stable, as within a dataset, blank node identifiers have no meaning. This specification defines a <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-4">normalized dataset</a> to include stable identifiers for blank nodes, but practical uses of this will always generate a canonical serialization of such a dataset.</p></div>

  <p>In time, there may be more than one canonicalization algorithm and,
    therefore, for identification purposes, this algorithm is named the
    "Universal RDF Dataset Canonicalization Algorithm 2015"
    (<abbr title="Universal RDF Dataset Canonicalization Algorithm 2015"><dfn id="dfn-urdna2015" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><abbr title="Universal RDF Dataset Canonicalization Algorithm 2015">URDNA2015</abbr></dfn></abbr>).</p>

  <div class="note" id="issue-container-generatedID-2"><div role="heading" class="ednote-title marker" id="h-ednote-2" aria-level="3"><span>Editor's note</span></div><p class="">This statement is overly prescriptive and does not include normative language.
    This spec should describe the theoretical basis for graph canonicalization and describe
    behavior using normative statements. The explicit algorithms should follow as an informative appendix.</p></div>

  <section id="canonicalization-algorithm-terms"><div class="header-wrapper"><h3 id="x4-1-canonicalization-algorithm-terms"><bdi class="secno">4.1 </bdi>Canonicalization Algorithm Terms</h3><a class="self-link" href="#canonicalization-algorithm-terms" aria-label="Permalink for Section 4.1"></a></div>
    
    <dl>
      <dt><dfn data-lt="input dataset|input datasets" id="dfn-input-dataset" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">input dataset</dfn></dt>
      <dd>The abstract <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-9">RDF dataset</a> that is provided as input to
        the algorithm.</dd>
      <dt><dfn id="dfn-normalized-dataset" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">normalized dataset</dfn></dt>
      <dd>The immutable, abstract <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-10">RDF dataset</a> and set of normalized
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-8">blank node identifiers</a> that are produced as output by the algorithm. A <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-5">normalized dataset</a> is a restriction on an <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-11">RDF dataset</a> where all nodes are labeled, and <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-5">blank nodes</a> are labeled with <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-9">blank node identifiers</a> consistent with running this algorithm on a base <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-12">RDF dataset</a>. A concrete serialization of an <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-6">normalized dataset</a> <em class="rfc2119">MUST</em> label all <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-6">blank nodes</a> using these stable <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-10">blank node identifiers</a>.</dd>
      <dt><dfn id="dfn-identifier-issuer" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">identifier issuer</dfn></dt>
      <dd>An identifier issuer is used to issue new <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-11">blank node identifier</a>. It
        maintains a
        <a href="#blank-node-identifier-issuer-state">blank node identifier issuer state</a>.</dd>
      <dt><dfn id="dfn-hash" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">hash</dfn></dt>
      <dd>The lowercase, hexadecimal representation of a message digest.</dd>
      <dt><dfn id="dfn-hash-algorithm" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">hash algorithm</dfn></dt>
      <dd>The hash algorithm used by <a href="#dfn-urdna2015" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-urdna2015-2"><abbr title="Universal RDF Dataset Canonicalization Algorithm 2015">URDNA2015</abbr></a>, namely, SHA-256.</dd>
    </dl>
  </section>

  <section id="canonicalization-state"><div class="header-wrapper"><h3 id="x4-2-canonicalization-state"><bdi class="secno">4.2 </bdi>Canonicalization State</h3><a class="self-link" href="#canonicalization-state" aria-label="Permalink for Section 4.2"></a></div>
    

    <p>When performing the steps required by the canonicalization algorithm,
      it is helpful to track state in a data structure called the
      <dfn id="dfn-canonicalization-state" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">canonicalization state</dfn>. The information contained in the
      <a href="#dfn-canonicalization-state" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonicalization-state-1">canonicalization state</a> is described below.</p>

    <dl>
      <dt><dfn id="dfn-blank-node-to-quads-map" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">blank node to quads map</dfn></dt>
      <dd>A data structure that maps a <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-12">blank node identifier</a> to
        the <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-2">quads</a> in which they appear in the
        <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-3">input dataset</a>.</dd>
      <dt><dfn id="dfn-hash-to-blank-nodes-map" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">hash to blank nodes map</dfn></dt>
      <dd>A data structure that maps a <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-1">hash</a> to a list of
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-13">blank node identifiers</a>.</dd>
      <dt><dfn id="dfn-canonical-issuer" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">canonical issuer</dfn></dt>
      <dd>An <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-1">identifier issuer</a>, initialized with the
        prefix <code>_:c14n</code>, for issuing canonical
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-14">blank node identifiers</a>.
        <div class="issue" id="issue-container-generatedID-3"><div role="heading" class="issue-title marker" id="h-issue-0" aria-level="4"><span>Issue</span></div><div class="">
          Mapping all <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-7">blank nodes</a> to use this
          identifier spec means that an <a href="#dfn-rdf-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-dataset-13">RDF dataset</a> composed of two
          different <a href="#dfn-rdf-graph" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-rdf-graph-1">RDF graphs</a> will use different
          identifiers then that for the graphs taken independently. This may
          happen anyway, due to <a href="https://en.wikipedia.org/wiki/Automorphism">automorphisms</a>,
          or overlapping statements, but an identifier based on the resulting
          <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-2">hash</a> along with an issue sequence number specific to that <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-3">hash</a> would
          stand a better chance of surviving such minor changes, and allow the
          resulting information to be useful for <a href="https://www.w3.org/2001/sw/wiki/How_to_diff_RDF">RDF Diff</a>.
        </div></div>
      </dd>
    </dl>
  </section>

  <section id="blank-node-identifier-issuer-state"><div class="header-wrapper"><h3 id="x4-3-blank-node-identifier-issuer-state"><bdi class="secno">4.3 </bdi>Blank Node Identifier Issuer State</h3><a class="self-link" href="#blank-node-identifier-issuer-state" aria-label="Permalink for Section 4.3"></a></div>
    

    <p>During the canonicalization algorithm, it is sometimes necessary to
      issue new identifiers to <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-8">blank nodes</a>. The
      <a href="#issue-identifier">Issue Identifier algorithm</a> uses an
      <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-2">identifier issuer</a> to accomplish this task. The information
      an <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-3">identifier issuer</a> needs to keep track of is described
      below.</p>

    <dl>
      <dt><dfn id="dfn-identifier-prefix" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">identifier prefix</dfn></dt>
      <dd>The identifier prefix is a string that is used at the beginning of an
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-15">blank node identifier</a>. It should be initialized to a
        string that is specified by the canonicalization algorithm. When
        generating a new <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-16">blank node identifier</a>, the prefix
        is concatenated with a <a href="#dfn-identifier-counter" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-counter-1">identifier counter</a>. For example,
        <code>_:c14n</code> is a proper initial value for the
        <a href="#dfn-identifier-prefix" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-prefix-1">identifier prefix</a> that would produce
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-17">blank node identifiers</a> like <code>_:c14n1</code>.</dd>
      <dt><dfn id="dfn-identifier-counter" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">identifier counter</dfn></dt>
      <dd>A counter that is appended to the <a href="#dfn-identifier-prefix" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-prefix-2">identifier prefix</a> to
        create an <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-18">blank node identifier</a>. It is initialized to
        <code>0</code>.</dd>
      <dt><dfn id="dfn-issued-identifiers-list" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">issued identifiers list</dfn></dt>
      <dd>A list that tracks previously issued identifiers in the order in
        which they were issued. It also tracks the existing identifier that
        triggered the issuance, to prevent issuing more than one new identifier
        per existing identifier, and to allow <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-9">blank nodes</a> to
        be reassigned identifiers some time after issuance.</dd>
    </dl>
  </section>

  <section id="canonicalization-algorithm"><div class="header-wrapper"><h3 id="x4-4-canonicalization-algorithm"><bdi class="secno">4.4 </bdi>Canonicalization Algorithm</h3><a class="self-link" href="#canonicalization-algorithm" aria-label="Permalink for Section 4.4"></a></div>
    

    <p>The canonicalization algorithm converts an <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-4">input dataset</a>
      into a <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-7">normalized dataset</a>. This algorithm will assign
      deterministic identifiers to any <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-10">blank nodes</a> in the
      <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-5">input dataset</a>.</p>

    <div class="note" id="issue-container-generatedID-4"><div role="heading" class="ednote-title marker" id="h-ednote-3" aria-level="4"><span>Editor's note</span></div><p class="">Documenting the algorithm is a WIP, various steps will
      become more detailed in time.</p></div>

    <div class="note" id="issue-container-generatedID-5"><div role="heading" class="ednote-title marker" id="h-ednote-4" aria-level="4"><span>Editor's note</span></div><p class="">See the note for the hash first degree quads
      algorithm. We should either remove the loop based on
      <code>simple</code> here but indicate that the original design
      of the algorithm was to have such a loop, or leave it but
      inform implementers that it is safe to break after one iteration
      of the loop (again, indicating why). A future version of this
      algorithm should make the loop effectual.
    </p></div>

    <section class="informative" id="overview"><div class="header-wrapper"><h4 id="x4-4-1-overview"><bdi class="secno">4.4.1 </bdi>Overview</h4><a class="self-link" href="#overview" aria-label="Permalink for Section 4.4.1"></a></div><p><em>This section is non-normative.</em></p>
      
    </section>

    <section id="algorithm"><div class="header-wrapper"><h4 id="x4-4-2-algorithm"><bdi class="secno">4.4.2 </bdi>Algorithm</h4><a class="self-link" href="#algorithm" aria-label="Permalink for Section 4.4.2"></a></div>
      

      <ol class="algorithm">
        <li>Create the <a href="#dfn-canonicalization-state" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonicalization-state-2">canonicalization state</a>.</li>
        <li>For every <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-3">quad</a> in <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-6">input dataset</a>:
          <ol class="algorithm">
            <li>For each <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-11">blank node</a> that occurs in the
              <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-4">quad</a>, add a reference to the
              <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-5">quad</a> using the
              <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-19">blank node identifier</a> in the
              <a href="#dfn-blank-node-to-quads-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-to-quads-map-1">blank node to quads map</a>, creating a new entry if
              necessary.
              <div class="issue" id="issue-container-generatedID-6"><div role="heading" class="issue-title marker" id="h-issue-1" aria-level="5"><span>Issue</span></div><div class="">It seems that quads must be normalized, so that literals with different syntactic representations but the same semantic representations are merged, and that two graphs differing in the syntactic representation of a literal will produce the same set of blank node identifiers.</div></div>
            </li>
          </ol>
        </li>
        <li>Create a list of non-normalized <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-20">blank node identifiers</a>
          <var>non-normalized identifiers</var> and populate it using the keys
          from the <a href="#dfn-blank-node-to-quads-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-to-quads-map-2">blank node to quads map</a>.</li>
        <li>Initialize <var>simple</var>, a boolean flag, to
          <code>true</code>.</li>
        <li>While <var>simple</var> is <code>true</code>,
          issue canonical identifiers for <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-12">blank nodes</a>:
          <ol class="algorithm">
            <li>Set <var>simple</var> to <code>false</code>.</li>
            <li>Clear <a href="#dfn-hash-to-blank-nodes-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-to-blank-nodes-map-1">hash to blank nodes map</a>.</li>
            <li>For each <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-21">blank node identifier</a>
              <var>identifier</var> in <var>non-normalized identifiers</var>:
              <ol class="algorithm">
                <li>Create a <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-4">hash</a>, <var>hash</var>, according to the
                  <a href="#hash-first-degree-quads">Hash First Degree Quads algorithm</a>.</li>
                <li>Add <var>hash</var> and <var>identifier</var> to
                  <a href="#dfn-hash-to-blank-nodes-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-to-blank-nodes-map-2">hash to blank nodes map</a>, creating a new entry if
                  necessary.</li>
              </ol>
            </li>
            <li>For each <var>hash</var> to <var>identifier list</var> mapping in
              <a href="#dfn-hash-to-blank-nodes-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-to-blank-nodes-map-3">hash to blank nodes map</a>, lexicographically-sorted by
              <var>hash</var>:
              <ol class="algorithm">
                <li>If the length of <var>identifier list</var> is greater than
                  <code>1</code>, continue to the next mapping.</li>
                <li>Use the
                  <a href="#issue-identifier">Issue Identifier algorithm</a>,
                  passing <a href="#dfn-canonical-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonical-issuer-1">canonical issuer</a> and the
                  single <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-22">blank node identifier</a> in
                  <var>identifier list</var>, <var>identifier</var>, to issue a
                  canonical replacement identifier for <var>identifier</var>.</li>
                <li>Remove <var>identifier</var> from
                  <var>non-normalized identifiers</var>.</li>
                <li>Remove <var>hash</var> from the
                  <a href="#dfn-hash-to-blank-nodes-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-to-blank-nodes-map-4">hash to blank nodes map</a>.</li>
                <li>Set <var>simple</var> to <code>true</code>.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>For each <var>hash</var> to <var>identifier list</var> mapping in
          <a href="#dfn-hash-to-blank-nodes-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-to-blank-nodes-map-5">hash to blank nodes map</a>, lexicographically-sorted by
          <var>hash</var>:
          <ol class="algorithm">
            <li>Create <var>hash path list</var> where each item will be a result
              of running the
              <a href="#hash-n-degree-quads">Hash N-Degree Quads algorithm</a>.</li>
            <li>For each <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-23">blank node identifier</a>
              <var>identifier</var> in <var>identifier list</var>:
              <ol class="algorithm">
                <li>If a canonical identifier has already been issued for
                  <var>identifier</var>, continue to the next
                  <var>identifier</var>.</li>
                <li>Create <var>temporary issuer</var>, an
                  <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-4">identifier issuer</a> initialized with the prefix
                  <code>_:b</code>.</li>
                <li>Use the
                  <a href="#issue-identifier">Issue Identifier algorithm</a>,
                  passing <var>temporary issuer</var> and <var>identifier</var>, to
                  issue a new temporary <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-24">blank node identifier</a>
                  for <var>identifier</var>.</li>
                <li>Run the
                  <a href="#hash-n-degree-quads">Hash N-Degree Quads algorithm</a>,
                  passing <var>temporary issuer</var>, and append the
                  result to the <var>hash path list</var>.</li>
              </ol>
            </li>
            <li>For each <var>result</var> in the <var>hash path list</var>,
              lexicographically-sorted by the <var>hash</var> in <var>result</var>:
              <ol class="algorithm">
                <li>For each <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-25">blank node identifier</a>,
                  <var>existing identifier</var>, that was issued a temporary
                  identifier by <var>identifier issuer</var> in <var>result</var>, issue
                  a canonical identifier, in the same order, using the
                  <a href="#issue-identifier">Issue Identifier algorithm</a>,
                  passing <a href="#dfn-canonical-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonical-issuer-2">canonical issuer</a> and
                  <var>existing identifier</var>.
              </li></ol>
            </li>
          </ol>
        </li>
        <li>For each <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-6">quad</a>, <var>quad</var>, in
          <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-7">input dataset</a>:
          <ol class="algorithm">
            <li>Create a copy, <var>quad copy</var>, of <var>quad</var> and replace any
              existing <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-26">blank node identifier</a>s using the
              canonical identifiers previously issued
              by <a href="#dfn-canonical-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonical-issuer-3">canonical issuer</a>.</li>
            <li>Add <var>quad copy</var> to the
              <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-8">normalized dataset</a>.</li>
          </ol>
        </li>
        <li>Return the <a href="#dfn-normalized-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-normalized-dataset-9">normalized dataset</a>.</li>
      </ol>
    </section>
  </section>

  <section id="issue-identifier"><div class="header-wrapper"><h3 id="x4-5-issue-identifier-algorithm"><bdi class="secno">4.5 </bdi>Issue Identifier Algorithm</h3><a class="self-link" href="#issue-identifier" aria-label="Permalink for Section 4.5"></a></div>
    

    <section class="informative" id="overview-0"><div class="header-wrapper"><h4 id="x4-5-1-overview"><bdi class="secno">4.5.1 </bdi>Overview</h4><a class="self-link" href="#overview-0" aria-label="Permalink for Section 4.5.1"></a></div><p><em>This section is non-normative.</em></p>
      
    </section>

    <section id="algorithm-0"><div class="header-wrapper"><h4 id="x4-5-2-algorithm"><bdi class="secno">4.5.2 </bdi>Algorithm</h4><a class="self-link" href="#algorithm-0" aria-label="Permalink for Section 4.5.2"></a></div>
      
    </section>

    <p>This algorithm issues a new <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-27">blank node identifier</a> for
      a given existing <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-28">blank node identifier</a>. It also updates
      state information that tracks the order in which new
      <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-29">blank node identifiers</a> were issued.</p>

    <p>This algorithm takes an <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-5">identifier issuer</a> and an
      <var>existing identifier</var> as inputs. The output is a new
      <var>issued identifier</var>. The steps of the algorithm are:</p>

    <ol class="algorithm">
      <li>If there is already an issued identifier for
        <var>existing identifier</var> in <a href="#dfn-issued-identifiers-list" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-issued-identifiers-list-1">issued identifiers list</a>,
        return it.</li>
      <li>Generate <var>issued identifier</var> by concatenating
        <a href="#dfn-identifier-prefix" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-prefix-3">identifier prefix</a> with the string value of
        <a href="#dfn-identifier-counter" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-counter-2">identifier counter</a>.</li>
      <li>Append an item to <a href="#dfn-issued-identifiers-list" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-issued-identifiers-list-2">issued identifiers list</a> that maps
        <var>existing identifier</var> to <var>issued identifier</var>.</li>
      <li>Increment <a href="#dfn-identifier-counter" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-counter-3">identifier counter</a>.</li>
      <li>Return <var>issued identifier</var>.</li>
    </ol>
  </section>

  <section id="hash-first-degree-quads"><div class="header-wrapper"><h3 id="x4-6-hash-first-degree-quads"><bdi class="secno">4.6 </bdi>Hash First Degree Quads</h3><a class="self-link" href="#hash-first-degree-quads" aria-label="Permalink for Section 4.6"></a></div>
    

    <div class="note" id="issue-container-generatedID-7"><div role="heading" class="ednote-title marker" id="h-ednote-5" aria-level="4"><span>Editor's note</span></div><p class="">Add note that the result of this algorithm for a
      particular blank node will always be the same. This is only true
      because there was a typo in the spec that has now been implemented
      by many implementations. The design of the algorithm was to use the
      assigned canonical blank node identifier, if available, instead of
      <code>_:a</code> or <code>_:z</code>, similar to how it is used in
      the related hash algorithm, but this text never made it into the spec
      before implementations moved forward. Therefore, the hashes here
      never change, making the loop based on the <code>simple</code>
      flag that calls this algorithm unnecessary; it needs to only run
      once. A future version of this algorithm should correct this mistake.
    </p></div>

    <section class="informative" id="overview-1"><div class="header-wrapper"><h4 id="x4-6-1-overview"><bdi class="secno">4.6.1 </bdi>Overview</h4><a class="self-link" href="#overview-1" aria-label="Permalink for Section 4.6.1"></a></div><p><em>This section is non-normative.</em></p>
      
    </section>

    <section id="algorithm-1"><div class="header-wrapper"><h4 id="x4-6-2-algorithm"><bdi class="secno">4.6.2 </bdi>Algorithm</h4><a class="self-link" href="#algorithm-1" aria-label="Permalink for Section 4.6.2"></a></div>
      

      <p>This algorithm takes the <a href="#dfn-canonicalization-state" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonicalization-state-3">canonicalization state</a> and a
        <dfn id="dfn-reference-blank-node-identifier" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">reference blank node identifier</dfn> as inputs.</p>

      <ol class="algorithm">
        <li>Initialize <dfn id="dfn-nquads" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">nquads</dfn> to an empty list. It will be
          used to store quads in N-Quads format.</li>
        <li>Get the list of <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-7">quads</a> <var>quads</var> associated with the
          <a href="#dfn-reference-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-reference-blank-node-identifier-1">reference blank node identifier</a> in the
          <a href="#dfn-blank-node-to-quads-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-to-quads-map-3">blank node to quads map</a>.</li>
        <li>For each <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-8">quad</a> <var>quad</var> in <var>quads</var>:
          <ol class="algorithm">
            <li>Serialize the <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-9">quad</a> in N-Quads format with the
              following special rule:
              <ol class="algorithm">
                <li>If any component in <var>quad</var> is an
                  <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-13">blank node</a>, then serialize it using a
                  special identifier as follows:
                  <ol class="algorithm">
                    <li>If the <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-14">blank node</a>'s existing
                    <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-30">blank node identifier</a> matches the
                    <a href="#dfn-reference-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-reference-blank-node-identifier-2">reference blank node identifier</a> then use the
                    <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-31">blank node identifier</a> <code>_:a</code>,
                    otherwise, use the <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-32">blank node identifier</a>
                    <code>_:z</code>.</li>
                  </ol>
                </li>
              </ol>
              <div class="issue" id="issue-container-generatedID-8"><div role="heading" class="issue-title marker" id="h-issue-2" aria-level="5"><span>Issue</span></div><p class="">Note potential need to normalize literals to their canonical representation here as well, if not done on the original <a href="#dfn-input-dataset" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-input-dataset-8">input dataset</a>.</p></div>
            </li>
          </ol>
        </li>
        <li>Sort <a href="#dfn-nquads" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nquads-1">nquads</a> in lexicographical order.</li>
        <li>Return the <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-5">hash</a> that results from passing the sorted,
          joined <a href="#dfn-nquads" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-nquads-2">nquads</a> through the
          <a href="#dfn-hash-algorithm" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-algorithm-1">hash algorithm</a>.</li>
      </ol>
    </section>
  </section>

  <section id="hash-related-blank-node"><div class="header-wrapper"><h3 id="x4-7-hash-related-blank-node"><bdi class="secno">4.7 </bdi>Hash Related Blank Node</h3><a class="self-link" href="#hash-related-blank-node" aria-label="Permalink for Section 4.7"></a></div>
    

    <section class="informative" id="overview-2"><div class="header-wrapper"><h4 id="x4-7-1-overview"><bdi class="secno">4.7.1 </bdi>Overview</h4><a class="self-link" href="#overview-2" aria-label="Permalink for Section 4.7.1"></a></div><p><em>This section is non-normative.</em></p>
      
    </section>

    <section id="algorithm-2"><div class="header-wrapper"><h4 id="x4-7-2-algorithm"><bdi class="secno">4.7.2 </bdi>Algorithm</h4><a class="self-link" href="#algorithm-2" aria-label="Permalink for Section 4.7.2"></a></div>
      

      <p>This algorithm creates a <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-6">hash</a> to identify how one
        <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-15">blank node</a> is related to another. It takes the
        <a href="#dfn-canonicalization-state" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonicalization-state-4">canonicalization state</a>, a <var>related</var>
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-33">blank node identifier</a>, a <var>quad</var>, an
        <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-6">identifier issuer</a>, <var>issuer</var>, and a
        <a href="#dfn-string" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-2">string</a> <var>position</var> as inputs.</p>

      <ol class="algorithm">
        <li>Set the <var>identifier</var> to use for <var>related</var>, preferring
          first the canonical identifier for <var>related</var> if issued, second
          the identifier issued by <var>issuer</var> if issued, and last, if
          necessary, the result of the
          <a href="#hash-first-degree-quads">Hash First Degree Quads algorithm</a>,
          passing <var>related</var>.
        </li>
        <li>Initialize a <a href="#dfn-string" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-3">string</a> <var>input</var> to the value of
          <var>position</var>.</li>
        <li>If <var>position</var> is not <code>g</code>, append
          <code>&lt;</code>, the value of the <a href="#dfn-predicate" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-predicate-2">predicate</a> in
          <var>quad</var>, and <code>&gt;</code> to <var>input</var>.</li>
        <li>Append <var>identifier</var> to <var>input</var>.</li>
        <li>Return the <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-7">hash</a> that results from passing <var>input</var>
          through the <a href="#dfn-hash-algorithm" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-algorithm-2">hash algorithm</a>.</li>
      </ol>
    </section>
  </section>

  <section id="hash-n-degree-quads"><div class="header-wrapper"><h3 id="x4-8-hash-n-degree-quads"><bdi class="secno">4.8 </bdi>Hash N-Degree Quads</h3><a class="self-link" href="#hash-n-degree-quads" aria-label="Permalink for Section 4.8"></a></div>
    

    <div class="note" id="issue-container-generatedID-9"><div role="heading" class="ednote-title marker" id="h-ednote-6" aria-level="4"><span>Editor's note</span></div><p class="">The relationship and difference between this algorithm
      and the hash first degree quads algorithm should be better explained.
      There may also be better names for the two algorithms.</p></div>

    <div class="note" id="issue-container-generatedID-10"><div role="heading" class="ednote-title marker" id="h-ednote-7" aria-level="4"><span>Editor's note</span></div><p class="">The 'path' terminology could also be changed to better
      indicate what a path is (a particular deterministic serialization for
      a subgraph/subdataset of nodes without globally-unique identifiers).</p></div>

    <section class="informative" id="overview-3"><div class="header-wrapper"><h4 id="x4-8-1-overview"><bdi class="secno">4.8.1 </bdi>Overview</h4><a class="self-link" href="#overview-3" aria-label="Permalink for Section 4.8.1"></a></div><p><em>This section is non-normative.</em></p>
      

      <p>Usually, when trying to determine if two nodes in a graph are
        equivalent, you simply compare their identifiers. However, what if the
        nodes don't have identifiers? Then you must determine if the two nodes
        have equivalent connections to equivalent nodes all throughout the
        whole graph. This is called the <a href="#dfn-graph-isomorphism" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-isomorphism-1">graph isomorphism</a> problem. This
        algorithm approaches this problem by considering how one might draw
        a graph on paper. You can test to see if two nodes are equivalent
        by drawing the graph twice. The first time you draw the graph the
        first node is drawn in the center of the page. If you can draw the
        graph a second time such that it looks just like the first, except
        the second node is in the center of the page, then the nodes are
        equivalent. This algorithm essentially defines a deterministic way to
        draw a graph where, if you begin with a particular node, the graph
        will always be drawn the same way. If two graphs are drawn the same way
        with two different nodes, then the nodes are equivalent. A
        <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-8">hash</a> is used to indicate a particular way that the graph
        has been drawn and can be used to compare nodes.</p>

      <p>This algorithm works in concert with the main canonicalization algorithm
        to produce a unique, deterministic identifier for a particular blank
        node. This <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-9">hash</a> incorporates all of the information that
        is connected to the blank node as well as how it is connected. It does
        this by creating deterministic paths that emanate out from the blank
        node through any other adjacent blank nodes.</p>
    </section>

    <section id="algorithm-3"><div class="header-wrapper"><h4 id="x4-8-2-algorithm"><bdi class="secno">4.8.2 </bdi>Algorithm</h4><a class="self-link" href="#algorithm-3" aria-label="Permalink for Section 4.8.2"></a></div>
      

      <div class="issue" id="issue-container-generatedID-11"><div role="heading" class="issue-title marker" id="h-issue-3" aria-level="5"><span>Issue</span></div><div class="">
        An additional input to this algorithm should be added that
        allows it to be optionally skipped and throw an error if any
        equivalent related hashes were produced that must be permuted
        during step 5.4.4. For practical uses of the algorithm, this step
        should never be encountered and could be turned off, disabling
        canonizing datasets that include a need to run it as a security
        measure.
      </div></div>

      <p>The inputs to this algorithm are the <a href="#dfn-canonicalization-state" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-canonicalization-state-5">canonicalization state</a>,
        the <var>identifier</var> for the <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-16">blank node</a> to
        recursively hash quads for, and path identifier <var>issuer</var> which is
        an <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-7">identifier issuer</a> that issues temporary
        <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-34">blank node identifier</a>s. The output from this algorithm
        will be a <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-10">hash</a> and the <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-8">identifier issuer</a> used
        to help generate it.</p>

      <ol class="algorithm">
        <li>Create a <var>hash to related blank nodes map</var> for storing
          hashes that identify related <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-17">blank nodes</a>.</li>
        <li>Get a reference, <var>quads</var>, to the list of <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-10">quads</a>
          in the <a href="#dfn-blank-node-to-quads-map" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-to-quads-map-4">blank node to quads map</a> for the key
          <var>identifier</var>.</li>
        <li>For each <var>quad</var> in <var>quads</var>:
          <ol class="algorithm">
            <li>For each <var>component</var> in <var>quad</var>, where <var>component</var>
              is the <a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-2">subject</a>, <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-2">object</a>, or
              <a href="#dfn-graph-name" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-name-3">graph name</a>, and it is a
              <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-18">blank node</a> that is not identified by
              <var>identifier</var>:
              <ol class="algorithm">
                <li>Set <var>hash</var> to the result of the
                  <a href="#hash-related-blank-node">Hash Related Blank Node algorithm</a>,
                  passing the <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-35">blank node identifier</a> for
                  <var>component</var> as <var>related</var>, <var>quad</var>,
                  <var>path identifier issuer</var> as <var>issuer</var>, and
                  <var>position</var> as either <code>s</code>, <code>o</code>, or
                  <code>g</code> based on whether <var>component</var> is a
                  <a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-3">subject</a>, <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-3">object</a>,
                  <a href="#dfn-graph-name" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-name-4">graph name</a>, respectively.</li>
                <li>Add a mapping of <var>hash</var> to the
                  <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-36">blank node identifier</a> for <var>component</var>
                  to <var>hash to related blank nodes map</var>, adding an entry
                  as necessary.</li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Create an empty string, <var>data to hash</var>.</li>
        <li>For each <var>related hash</var> to <var>blank node list</var> mapping in
          <var>hash to related blank nodes map</var>, sorted lexicographically
          by <var>related hash</var>:
          <ol class="algorithm">
            <li>Append the <var>related hash</var> to the <var>data to hash</var>.</li>
            <li>Create a <a href="#dfn-string" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-4">string</a> <var>chosen path</var>.</li>
            <li>Create an unset <var>chosen issuer</var> variable.</li>
            <li>For each <var>permutation</var> of <var>blank node list</var>:
              <ol class="algorithm">
                <li>Create a copy of <var>issuer</var>, <var>issuer copy</var>.</li>
                <li>Create a <a href="#dfn-string" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-5">string</a> <var>path</var>.</li>
                <li>Create a <var>recursion list</var>, to store
                  <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-37">blank node identifiers</a> that must be
                  recursively processed by this algorithm.</li>
                <li>For each <var>related</var> in <var>permutation</var>:
                  <ol class="algorithm">
                    <li>If a canonical identifier has been issued for
                      <var>related</var>, append it to <var>path</var>.</li>
                    <li>Otherwise:
                      <ol class="algorithm">
                        <li>If <i>issuer copy</i> has not issued
                          an identifier for <var>related</var>, append
                          <var>related</var> to <var>recursion list</var>.</li>
                        <li>Use the
                          <a href="#issue-identifier">Issue Identifier algorithm</a>,
                          passing <var>issuer copy</var> and <var>related</var> and
                          append the result to <var>path</var>.</li>
                      </ol>
                    </li>
                    <li>If <var>chosen path</var> is not empty and the length
                      of <var>path</var> is greater than or equal to the length
                      of <var>chosen path</var> and <var>path</var> is lexicographically
                      greater than <var>chosen path</var>, then skip to the next
                      <var>permutation</var>.
                    </li>
                  </ol>
                </li>
                <li>For each <var>related</var> in <var>recursion list</var>:
                  <ol class="algorithm">
                    <li>Set <var>result</var> to the result of recursively executing
                      the
                      <a href="#hash-n-degree-quads">Hash N-Degree Quads algorithm</a>,
                      passing <var>related</var> for <var>identifier</var> and
                      <var>issuer copy</var> for <var>path identifier issuer</var>.</li>
                    <li>Use the
                      <a href="#issue-identifier">Issue Identifier algorithm</a>,
                      passing <var>issuer copy</var> and <var>related</var> and
                      append the result to <var>path</var>.</li>
                    <li>Append <code>&lt;</code>, the <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-11">hash</a> in
                      <var>result</var>, and <code>&gt;</code> to <var>path</var>.</li>
                    <li>Set <var>issuer copy</var> to the
                      <a href="#dfn-identifier-issuer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-identifier-issuer-9">identifier issuer</a> in result.</li>
                    <li>If <var>chosen path</var> is not empty and the length
                      of <var>path</var> is greater than or equal to the length
                      of <var>chosen path</var> and <var>path</var> is lexicographically
                      greater than <var>chosen path</var>, then skip to the next
                      <var>permutation</var>.</li>
                  </ol>
                </li>
                <li>If <var>chosen path</var> is empty or <var>path</var> is
                  lexicographically less than <var>chosen path</var>, set
                  <var>chosen path</var> to <var>path</var> and <var>chosen issuer</var>
                  to <var>issuer copy</var>.</li>
              </ol>
            </li>
            <li>Append <var>chosen path</var> to <var>data to hash</var>.</li>
            <li>Replace <var>issuer</var>, by reference, with
              <var>chosen issuer</var>.</li>
          </ol>
        </li>
        <li>Return <var>issuer</var> and the <a href="#dfn-hash" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-12">hash</a> that results from
          passing <var>data to hash</var> through the
          <a href="#dfn-hash-algorithm" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-hash-algorithm-3">hash algorithm</a>.</li>
      </ol>
    </section>
  </section>
</section>

<section id="use-cases"><div class="header-wrapper"><h2 id="x5-use-cases"><bdi class="secno">5. </bdi>Use Cases</h2><a class="self-link" href="#use-cases" aria-label="Permalink for Section 5."></a></div>
  
  <div class="note" id="issue-container-generatedID-12"><div role="heading" class="ednote-title marker" id="h-ednote-8" aria-level="3"><span>Editor's note</span></div><p class="">TBD</p></div>
</section>

<section id="examples"><div class="header-wrapper"><h2 id="x6-examples"><bdi class="secno">6. </bdi>Examples</h2><a class="self-link" href="#examples" aria-label="Permalink for Section 6."></a></div>
  
  <div class="note" id="issue-container-generatedID-13"><div role="heading" class="ednote-title marker" id="h-ednote-9" aria-level="3"><span>Editor's note</span></div><p class="">TBD</p></div>
</section>

<section class="appendix" id="urgna2012"><div class="header-wrapper"><h2 id="a-urgna2012"><bdi class="secno">A. </bdi><abbr title="Universal RDF Graph Canonicalization Algorithm 2012">URGNA2012</abbr></h2><a class="self-link" href="#urgna2012" aria-label="Permalink for Appendix A."></a></div>
  
  <p>A previous version of this algorithm has light deployment. For purposes of identification,
    the algorithm is called the
    "Universal RDF Graph Canonicalization Algorithm 2012"
    (<abbr title="Universal RDF Graph Canonicalization Algorithm 2012"><dfn id="dfn-urgna2012" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn"><abbr title="Universal RDF Graph Canonicalization Algorithm 2012">URGNA2012</abbr></dfn></abbr>),
    and differs from the stated algorithm in the following ways:</p>
  <ul>
    <li>In <a href="#hash-first-degree-quads" class="sectionRef sec-ref"><bdi class="secno">4.6 </bdi>Hash First Degree Quads</a>, if any blank node was used in the <a href="#dfn-graph-name" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-name-5">graph name</a>
      position in the <a href="#dfn-quad" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-quad-11">quad</a>, then the value was serialized using
      the special <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-38">blank node identifier</a>, <code>_:g</code>, instead of <code>_:z</code>.</li>
    <li>In <a href="#hash-related-blank-node" class="sectionRef sec-ref"><bdi class="secno">4.7 </bdi>Hash Related Blank Node</a>, value of the <a href="#dfn-predicate" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-predicate-3">predicate</a>
      was not delimited by <code>&lt;</code> and <code>&gt;</code>; there
      were no delimiters.</li>
    <li>In <a href="#hash-n-degree-quads" class="sectionRef sec-ref"><bdi class="secno">4.8 </bdi>Hash N-Degree Quads</a>, the <var>position</var> parameter passed to
      the <a href="#hash-related-blank-node">Hash Related Blank Node algorithm</a>
      was instead modeled as a <var>direction</var> parameter, where it could have
      the value <code>p</code>, for property, when the related blank node was a
      <a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-4">subject</a> and the value <code>r</code>, for reverse or reference, when
      the related blank node was an <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-4">object</a>. Since <a href="#dfn-urgna2012" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-urgna2012-1"><abbr title="Universal RDF Graph Canonicalization Algorithm 2012">URGNA2012</abbr></a> only normalized
      graphs, not datasets, there was no use of the <a href="#dfn-graph-name" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-graph-name-6">graph name</a> position.</li>
    <li>In <a href="#hash-n-degree-quads" class="sectionRef sec-ref"><bdi class="secno">4.8 </bdi>Hash N-Degree Quads</a>, building the
      <var>hash to related blank nodes map</var> was done as follows:
      <ol class="algorithm">
        <li>For each <var>quad</var> in <var>quads</var>:
          <ol class="algorithm">
            <li>If the <var>quad</var>'s <a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-5">subject</a> is a <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-19">blank node</a> that does not
              match <var>identifier</var>, set <var>hash</var> to the result of the
                <a href="#hash-related-blank-node">Hash Related Blank Node algorithm</a>,
                passing the <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-39">blank node identifier</a> for
                <a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-6">subject</a> as <var>related</var>, <var>quad</var>,
                <var>path identifier issuer</var> as <var>issuer</var>, and
                <code>p</code> as <var>position</var>.
            </li>
            <li>Otherwise, if <var>quad</var>'s <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-5">object</a> is a <a href="#dfn-blank-node" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-20">blank node</a> that does
              not match <var>identifier</var>, set <var>hash</var> to the result of the
                <a href="#hash-related-blank-node">Hash Related Blank Node algorithm</a>,
                passing the <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-40">blank node identifier</a> for
                <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-6">object</a> as <var>related</var>, <var>quad</var>,
                <var>path identifier issuer</var> as <var>issuer</var>, and
                <code>r</code> as <var>position</var>.
            </li>
            <li>Otherwise, continue to the next quad.</li>
            <li>Add a mapping of <var>hash</var> to the
              <a href="#dfn-blank-node-identifier" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-blank-node-identifier-41">blank node identifier</a> for the component
              that matched (<a href="#dfn-subject" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-subject-7">subject</a> or <a href="#dfn-object" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-object-7">object</a>) to
              <var>hash to related blank nodes map</var>, adding an entry
              as necessary.</li>
          </ol>
        </li>
      </ol>
    </li>
  </ul>
</section>

<section class="appendix" id="acknowledgements"><div class="header-wrapper"><h2 id="b-acknowledgements"><bdi class="secno">B. </bdi>Acknowledgements</h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Appendix B."></a></div>
  

  <p>The editors would like to thank Jeremy Carroll for his work on the
    graph canonicalization problem, Gavin Carothers for providing valuable
    feedback and testing input for the algorithm defined in this
    specification, Sir Tim Berners Lee for his thoughts on graph canonicalization
    over the years, Jesús Arias Fisteus for his work on a similar
    algorithm.</p>
</section>



<section id="references" class="appendix"><div class="header-wrapper"><h2 id="c-references"><bdi class="secno">C. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix C."></a></div><section id="normative-references"><div class="header-wrapper"><h3 id="c-1-normative-references"><bdi class="secno">C.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix C.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-rdf-concepts">[RDF-CONCEPTS]</dt><dd>
      <a href="https://www.w3.org/TR/rdf-concepts/"><cite>Resource Description Framework (RDF): Concepts and Abstract Syntax</cite></a>. Graham Klyne; Jeremy Carroll.  W3C. 10 February 2004. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf-concepts/">https://www.w3.org/TR/rdf-concepts/</a>
    </dd><dt id="bib-rdf-mt">[RDF-MT]</dt><dd>
      <a href="https://www.w3.org/TR/rdf-mt/"><cite>RDF Semantics</cite></a>. Patrick Hayes.  W3C. 10 February 2004. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf-mt/">https://www.w3.org/TR/rdf-mt/</a>
    </dd><dt id="bib-rdf11-concepts">[RDF11-CONCEPTS]</dt><dd>
      <a href="https://www.w3.org/TR/rdf11-concepts/"><cite>RDF 1.1 Concepts and Abstract Syntax</cite></a>. Richard Cyganiak; David Wood; Markus Lanthaler.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf11-concepts/">https://www.w3.org/TR/rdf11-concepts/</a>
    </dd><dt id="bib-rdf11-mt">[RDF11-MT]</dt><dd>
      <a href="https://www.w3.org/TR/rdf11-mt/"><cite>RDF 1.1 Semantics</cite></a>. Patrick Hayes; Peter Patel-Schneider.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf11-mt/">https://www.w3.org/TR/rdf11-mt/</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc3987">[RFC3987]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc3987"><cite>Internationalized Resource Identifiers (IRIs)</cite></a>. M. Duerst; M. Suignard.  IETF. January 2005. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3987">https://www.rfc-editor.org/rfc/rfc3987</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-graph-isomorphism" aria-label="Links in this document to definition: graph isomorphism" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-graph-isomorphism" aria-label="Permalink for definition: graph isomorphism. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-graph-isomorphism-1" title="§ 4.8.1 Overview">§ 4.8.1 Overview</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-string" aria-label="Links in this document to definition: string" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-string" aria-label="Permalink for definition: string. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-string-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-string-2" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> <a href="#ref-for-dfn-string-3" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-string-4" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-string-5" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-internationalized-resource-identifier" aria-label="Links in this document to definition: IRI" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-internationalized-resource-identifier" aria-label="Permalink for definition: IRI. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-internationalized-resource-identifier-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> <a href="#ref-for-dfn-internationalized-resource-identifier-2" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-subject" aria-label="Links in this document to definition: subject" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-subject" aria-label="Permalink for definition: subject. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-subject-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-subject-2" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-subject-3" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-subject-4" title="§ A. URGNA2012">§ A. URGNA2012</a> <a href="#ref-for-dfn-subject-5" title="Reference 2">(2)</a> <a href="#ref-for-dfn-subject-6" title="Reference 3">(3)</a> <a href="#ref-for-dfn-subject-7" title="Reference 4">(4)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-predicate" aria-label="Links in this document to definition: predicate" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-predicate" aria-label="Permalink for definition: predicate. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-predicate-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-predicate-2" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-predicate-3" title="§ A. URGNA2012">§ A. URGNA2012</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-object" aria-label="Links in this document to definition: object" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-object" aria-label="Permalink for definition: object. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-object-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-object-2" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-object-3" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-object-4" title="§ A. URGNA2012">§ A. URGNA2012</a> <a href="#ref-for-dfn-object-5" title="Reference 2">(2)</a> <a href="#ref-for-dfn-object-6" title="Reference 3">(3)</a> <a href="#ref-for-dfn-object-7" title="Reference 4">(4)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-rdf-triple" aria-label="Links in this document to definition: RDF triple" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-rdf-triple" aria-label="Permalink for definition: RDF triple. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-rdf-triple-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-rdf-graph" aria-label="Links in this document to definition: RDF graph" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-rdf-graph" aria-label="Permalink for definition: RDF graph. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-rdf-graph-1" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-graph-name" aria-label="Links in this document to definition: graph name" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-graph-name" aria-label="Permalink for definition: graph name. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-graph-name-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> <a href="#ref-for-dfn-graph-name-2" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-graph-name-3" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-graph-name-4" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-graph-name-5" title="§ A. URGNA2012">§ A. URGNA2012</a> <a href="#ref-for-dfn-graph-name-6" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-quad" aria-label="Links in this document to definition: quad" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-quad" aria-label="Permalink for definition: quad. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-quad-1" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-quad-2" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li><li>
    <a href="#ref-for-dfn-quad-3" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-quad-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-quad-5" title="Reference 3">(3)</a> <a href="#ref-for-dfn-quad-6" title="Reference 4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-quad-7" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> <a href="#ref-for-dfn-quad-8" title="Reference 2">(2)</a> <a href="#ref-for-dfn-quad-9" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-quad-10" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-quad-11" title="§ A. URGNA2012">§ A. URGNA2012</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-rdf-dataset" aria-label="Links in this document to definition: RDF dataset" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-rdf-dataset" aria-label="Permalink for definition: RDF dataset. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-rdf-dataset-1" title="§ Abstract">§ Abstract</a> 
  </li><li>
    <a href="#ref-for-dfn-rdf-dataset-2" title="§ 1. Introduction">§ 1. Introduction</a> <a href="#ref-for-dfn-rdf-dataset-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-rdf-dataset-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-rdf-dataset-5" title="Reference 4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-rdf-dataset-6" title="§ 1.2 How to Read this Document">§ 1.2 How to Read this Document</a> <a href="#ref-for-dfn-rdf-dataset-7" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-rdf-dataset-8" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-rdf-dataset-9" title="§ 4.1 Canonicalization Algorithm Terms">§ 4.1 Canonicalization Algorithm Terms</a> <a href="#ref-for-dfn-rdf-dataset-10" title="Reference 2">(2)</a> <a href="#ref-for-dfn-rdf-dataset-11" title="Reference 3">(3)</a> <a href="#ref-for-dfn-rdf-dataset-12" title="Reference 4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-rdf-dataset-13" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-blank-node" aria-label="Links in this document to definition: blank node" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-blank-node" aria-label="Permalink for definition: blank node. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-blank-node-1" title="§ 1.1 Uses of Dataset Canonicalization">§ 1.1 Uses of Dataset Canonicalization</a> <a href="#ref-for-dfn-blank-node-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-3" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-4" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-5" title="§ 4.1 Canonicalization Algorithm Terms">§ 4.1 Canonicalization Algorithm Terms</a> <a href="#ref-for-dfn-blank-node-6" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-7" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-8" title="§ 4.3 Blank Node Identifier Issuer State">§ 4.3 Blank Node Identifier Issuer State</a> <a href="#ref-for-dfn-blank-node-9" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-10" title="§ 4.4 Canonicalization Algorithm">§ 4.4 Canonicalization Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-11" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-12" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-13" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-14" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-15" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-16" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-17" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-18" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-19" title="§ A. URGNA2012">§ A. URGNA2012</a> <a href="#ref-for-dfn-blank-node-20" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-blank-node-identifier" aria-label="Links in this document to definition: blank node identifier" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-blank-node-identifier" aria-label="Permalink for definition: blank node identifier. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-blank-node-identifier-1" title="§ 1.1 Uses of Dataset Canonicalization">§ 1.1 Uses of Dataset Canonicalization</a> <a href="#ref-for-dfn-blank-node-identifier-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-blank-node-identifier-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-blank-node-identifier-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-blank-node-identifier-6" title="Reference 6">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-7" title="§ 3.1 General Terminology">§ 3.1 General Terminology</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-8" title="§ 4.1 Canonicalization Algorithm Terms">§ 4.1 Canonicalization Algorithm Terms</a> <a href="#ref-for-dfn-blank-node-identifier-9" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-10" title="Reference 3">(3)</a> <a href="#ref-for-dfn-blank-node-identifier-11" title="Reference 4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-12" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> <a href="#ref-for-dfn-blank-node-identifier-13" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-14" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-15" title="§ 4.3 Blank Node Identifier Issuer State">§ 4.3 Blank Node Identifier Issuer State</a> <a href="#ref-for-dfn-blank-node-identifier-16" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-17" title="Reference 3">(3)</a> <a href="#ref-for-dfn-blank-node-identifier-18" title="Reference 4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-19" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-identifier-20" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-21" title="Reference 3">(3)</a> <a href="#ref-for-dfn-blank-node-identifier-22" title="Reference 4">(4)</a> <a href="#ref-for-dfn-blank-node-identifier-23" title="Reference 5">(5)</a> <a href="#ref-for-dfn-blank-node-identifier-24" title="Reference 6">(6)</a> <a href="#ref-for-dfn-blank-node-identifier-25" title="Reference 7">(7)</a> <a href="#ref-for-dfn-blank-node-identifier-26" title="Reference 8">(8)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-27" title="§ 4.5 Issue Identifier Algorithm">§ 4.5 Issue Identifier Algorithm</a> <a href="#ref-for-dfn-blank-node-identifier-28" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-29" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-30" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-identifier-31" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-32" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-33" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-34" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-identifier-35" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-36" title="Reference 3">(3)</a> <a href="#ref-for-dfn-blank-node-identifier-37" title="Reference 4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-identifier-38" title="§ A. URGNA2012">§ A. URGNA2012</a> <a href="#ref-for-dfn-blank-node-identifier-39" title="Reference 2">(2)</a> <a href="#ref-for-dfn-blank-node-identifier-40" title="Reference 3">(3)</a> <a href="#ref-for-dfn-blank-node-identifier-41" title="Reference 4">(4)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-urdna2015" aria-label="Links in this document to definition: URDNA2015" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-urdna2015" aria-label="Permalink for definition: URDNA2015. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-urdna2015-1" title="§ 1. Introduction">§ 1. Introduction</a> 
  </li><li>
    <a href="#ref-for-dfn-urdna2015-2" title="§ 4.1 Canonicalization Algorithm Terms">§ 4.1 Canonicalization Algorithm Terms</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-input-dataset" aria-label="Links in this document to definition: input dataset" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-input-dataset" aria-label="Permalink for definition: input dataset. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-input-dataset-1" title="§ 4. Canonicalization">§ 4. Canonicalization</a> <a href="#ref-for-dfn-input-dataset-2" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-input-dataset-3" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li><li>
    <a href="#ref-for-dfn-input-dataset-4" title="§ 4.4 Canonicalization Algorithm">§ 4.4 Canonicalization Algorithm</a> <a href="#ref-for-dfn-input-dataset-5" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-input-dataset-6" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-input-dataset-7" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-input-dataset-8" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-normalized-dataset" aria-label="Links in this document to definition: normalized dataset" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-normalized-dataset" aria-label="Permalink for definition: normalized dataset. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-normalized-dataset-1" title="§ 1.1 Uses of Dataset Canonicalization">§ 1.1 Uses of Dataset Canonicalization</a> 
  </li><li>
    <a href="#ref-for-dfn-normalized-dataset-2" title="§ 4. Canonicalization">§ 4. Canonicalization</a> <a href="#ref-for-dfn-normalized-dataset-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-normalized-dataset-4" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-normalized-dataset-5" title="§ 4.1 Canonicalization Algorithm Terms">§ 4.1 Canonicalization Algorithm Terms</a> <a href="#ref-for-dfn-normalized-dataset-6" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-normalized-dataset-7" title="§ 4.4 Canonicalization Algorithm">§ 4.4 Canonicalization Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-normalized-dataset-8" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-normalized-dataset-9" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-identifier-issuer" aria-label="Links in this document to definition: identifier issuer" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-identifier-issuer" aria-label="Permalink for definition: identifier issuer. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-identifier-issuer-1" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-issuer-2" title="§ 4.3 Blank Node Identifier Issuer State">§ 4.3 Blank Node Identifier Issuer State</a> <a href="#ref-for-dfn-identifier-issuer-3" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-issuer-4" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-issuer-5" title="§ 4.5 Issue Identifier Algorithm">§ 4.5 Issue Identifier Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-issuer-6" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-issuer-7" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-identifier-issuer-8" title="Reference 2">(2)</a> <a href="#ref-for-dfn-identifier-issuer-9" title="Reference 3">(3)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-hash" aria-label="Links in this document to definition: hash" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-hash" aria-label="Permalink for definition: hash. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-hash-1" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> <a href="#ref-for-dfn-hash-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-hash-3" title="Reference 3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-4" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-5" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-6" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> <a href="#ref-for-dfn-hash-7" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-8" title="§ 4.8.1 Overview">§ 4.8.1 Overview</a> <a href="#ref-for-dfn-hash-9" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-10" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> <a href="#ref-for-dfn-hash-11" title="Reference 2">(2)</a> <a href="#ref-for-dfn-hash-12" title="Reference 3">(3)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-hash-algorithm" aria-label="Links in this document to definition: hash algorithm" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-hash-algorithm" aria-label="Permalink for definition: hash algorithm. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-hash-algorithm-1" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-algorithm-2" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-hash-algorithm-3" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-canonicalization-state" aria-label="Links in this document to definition: canonicalization state" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-canonicalization-state" aria-label="Permalink for definition: canonicalization state. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-canonicalization-state-1" title="§ 4.2 Canonicalization State">§ 4.2 Canonicalization State</a> 
  </li><li>
    <a href="#ref-for-dfn-canonicalization-state-2" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-canonicalization-state-3" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-canonicalization-state-4" title="§ 4.7.2 Algorithm">§ 4.7.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-canonicalization-state-5" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-blank-node-to-quads-map" aria-label="Links in this document to definition: blank node to quads map" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-blank-node-to-quads-map" aria-label="Permalink for definition: blank node to quads map. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-blank-node-to-quads-map-1" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-blank-node-to-quads-map-2" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-to-quads-map-3" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> 
  </li><li>
    <a href="#ref-for-dfn-blank-node-to-quads-map-4" title="§ 4.8.2 Algorithm">§ 4.8.2 Algorithm</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-hash-to-blank-nodes-map" aria-label="Links in this document to definition: hash to blank nodes map" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-hash-to-blank-nodes-map" aria-label="Permalink for definition: hash to blank nodes map. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-hash-to-blank-nodes-map-1" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-hash-to-blank-nodes-map-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-hash-to-blank-nodes-map-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-hash-to-blank-nodes-map-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-hash-to-blank-nodes-map-5" title="Reference 5">(5)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-canonical-issuer" aria-label="Links in this document to definition: canonical issuer" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-canonical-issuer" aria-label="Permalink for definition: canonical issuer. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-canonical-issuer-1" title="§ 4.4.2 Algorithm">§ 4.4.2 Algorithm</a> <a href="#ref-for-dfn-canonical-issuer-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-canonical-issuer-3" title="Reference 3">(3)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-identifier-prefix" aria-label="Links in this document to definition: identifier prefix" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-identifier-prefix" aria-label="Permalink for definition: identifier prefix. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-identifier-prefix-1" title="§ 4.3 Blank Node Identifier Issuer State">§ 4.3 Blank Node Identifier Issuer State</a> <a href="#ref-for-dfn-identifier-prefix-2" title="Reference 2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-prefix-3" title="§ 4.5 Issue Identifier Algorithm">§ 4.5 Issue Identifier Algorithm</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-identifier-counter" aria-label="Links in this document to definition: identifier counter" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-identifier-counter" aria-label="Permalink for definition: identifier counter. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-identifier-counter-1" title="§ 4.3 Blank Node Identifier Issuer State">§ 4.3 Blank Node Identifier Issuer State</a> 
  </li><li>
    <a href="#ref-for-dfn-identifier-counter-2" title="§ 4.5 Issue Identifier Algorithm">§ 4.5 Issue Identifier Algorithm</a> <a href="#ref-for-dfn-identifier-counter-3" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-issued-identifiers-list" aria-label="Links in this document to definition: issued identifiers list" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-issued-identifiers-list" aria-label="Permalink for definition: issued identifiers list. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-issued-identifiers-list-1" title="§ 4.5 Issue Identifier Algorithm">§ 4.5 Issue Identifier Algorithm</a> <a href="#ref-for-dfn-issued-identifiers-list-2" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-reference-blank-node-identifier" aria-label="Links in this document to definition: reference blank node identifier" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-reference-blank-node-identifier" aria-label="Permalink for definition: reference blank node identifier. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-reference-blank-node-identifier-1" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> <a href="#ref-for-dfn-reference-blank-node-identifier-2" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-nquads" aria-label="Links in this document to definition: nquads" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-nquads" aria-label="Permalink for definition: nquads. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-nquads-1" title="§ 4.6.2 Algorithm">§ 4.6.2 Algorithm</a> <a href="#ref-for-dfn-nquads-2" title="Reference 2">(2)</a> 
  </li>
  </ul>
    </div><div class="dfn-panel" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-urgna2012" aria-label="Links in this document to definition: URGNA2012" hidden="">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-urgna2012" aria-label="Permalink for definition: URGNA2012. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
    <a href="#ref-for-dfn-urgna2012-1" title="§ A. URGNA2012">§ A. URGNA2012</a> 
  </li>
  </ul>
    </div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>